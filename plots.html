<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gráficos</title>
  <script src="lib/jquery.min.js"></script>
  <script src="lib/plotly-latest.min.js"></script>
  <script src="lib/underscore-min.js"></script>
</head>
<body>
<script>
  var implementations = [
    { name: 'Determinista (Dinic)' },
    { name: 'Karger' },
    { name: 'Una Mezcla'}
  ];

  function plot(data, layout) {
    var div = $('<div>');
    Plotly.newPlot(div[0], data, layout);
    return div;
  }

  function renderTable(table) {
    return $('<table>').append(
      $('<thead>').append(
        $('<th>').append(
          $.map(table.columns, function (column) {
            return $('<td>').text(column);
          })
        )
      ),
      $('<tbody>').append(
        $.map(table.rows, function (row) {
          return $('<tr>').append(
            $.map(table.columns, function (column) {
              return $('<td>').text(row[column]);
            })
          );
        })
      )
    );
  }

  function getParams(experiment) {
    var allParams = ['n', 'p', 'k', 't'];
    var params = [];
    var text = [];
    $.each(allParams, function (i, param) {
      if (param in experiment) {
        params.push(param);
        text.push(param + ': ' + experiment[param]);
      }
    });
    text = text.join(', ');
    return { params: params, text: text };
  }

  function getMeasureText(measure) {
    return measure.mean + '±' + measure.std;
  }

  function makeTable(results) {
    return {
      columns: getParams(results[0]).params,
      rows: $.map(results, function (experiment) {
        var params = getParams(experiment).params;
        return $.map(params, function (param) {
          return getMeasureText(experiment[param]);
        });
      })
    };
  }

  function plotImplResults(implResults) {
    return $('<div>').append(
      $.map(implResults, function (experiment) {
        return $('<div>').append(
          $('<h3 class="section">').text(getParams(experiment).text),
          // $('<pre>').text(JSON.stringify(experiment, null, '\t'))
          renderTable(makeTable(implResults))
        );
      })
    );
  }

  $.getJSON('allResults.json', function (allResults) {
    $(function () {
      $('body').append(
        $.map(allResults, function (implResults, i) {
          var impl = implementations[i];
          return $('<div>').append(
            $('<h2 class="section">').text(impl.name),
            plotImplResults(implResults)
          );
        })
      );
    });

    var collapsedIcon = '▸ ', expandedIcon = '▾ ';
    $('.section').each(function () {
      var $title = $(this);
      var $section = $title.next();

      var $triangle = $('<span>');
      $triangle.text(expandedIcon);
      $triangle.on('click', function () {
        var currentIcon = $triangle.text();
        if (currentIcon === expandedIcon) {
          $section.slideUp('fast', function () {
            $triangle.text(collapsedIcon);
          });
        }
        else {
          $section.slideDown('fast', function () {
            $triangle.text(expandedIcon);
          });
        }
      });

      $title.prepend($triangle);
    });
  });
</script>
</body>
</html>