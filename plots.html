<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gráficos</title>
  <script src="lib/jquery.min.js"></script>
  <script src="lib/plotly-latest.min.js"></script>
  <script src="lib/underscore-min.js"></script>
</head>
<body>
<script>
  const implementations = [
    { name: 'Determinista (Dinic)' },
    { name: 'Karger' },
    { name: 'Una Mezcla'}
  ];

  function plot(data, layout) {
    const div = $('<div>');
    Plotly.newPlot(div[0], data, layout);
    return div;
  }

  function renderTable(table) {
    return $('<table>').append(
      $('<thead>').append(
        $('<tr>').append(
          $.map(table.columns, function (column) {
            return $('<th style="width: 8em">').text(column);
          })
        )
      ),
      $('<tbody>').append(
        $.map(table.rows, function (row) {
          return $('<tr style="width: 8em">').append(
            $.map(table.columns, function (column) {
              return $('<td style="text-align: center">').text(row[column]);
            })
          );
        })
      )
    );
  }

  function getParams(experiment) {
    const allParams = ['n', 'p', 'k', 't'];
    const params = [];
    let text = [];
    $.each(allParams, function (i, param) {
      if (param in experiment) {
        params.push(param);
        text.push(param + ': ' + experiment[param]);
      }
    });
    text = text.join(', ');
    return { params, text };
  }

  function getMeasureText(measure) {
    return measure.mean.toFixed(2) + '±' + measure.std.toFixed(2);
  }

  function makeTable(results) {
    const columns = [...getParams(results[0]).params,
      'time', 'probError'];
    return {
      columns,
      rows: _.map(results, function (experiment) {
        return _.mapObject(experiment, (value, key) => {
          if (key.length === 1) {
            return key === 'n' ? value : value.toFixed(2);
          }
          return getMeasureText(value);
        });
      })
    };
  }

  function plotImplResults(implResults) {
    return renderTable(makeTable(implResults));
    // return $('<div>').append(
    //   $.map(implResults, function (experiment) {
    //     return $('<div>').append(
    //       $('<h3 class="section">').text(getParams(experiment).text),
    //       // $('<pre>').text(JSON.stringify(experiment, null, '\t'))
    //       renderTable(makeTable(implResults))
    //     );
    //   })
    // );
  }

  $.getJSON('allResults.json', function (allResults) {
    $(function () {
      $('body').append(
        $.map(allResults, function (implResults, i) {
          const impl = implementations[i];
          return $('<div>').append(
            $('<h2 class="section">').text(impl.name),
            plotImplResults(implResults)
          );
        })
      );

      const collapsedIcon = '▸ ', expandedIcon = '▾ ';
      $('.section').each(function () {
        const $title = $(this);
        const $section = $title.next();

        const $triangle = $('<span>');
        $triangle.text(expandedIcon);
        $triangle.on('click', function () {
          const currentIcon = $triangle.text();
          if (currentIcon === expandedIcon) {
            $section.slideUp('fast', function () {
              $triangle.text(collapsedIcon);
            });
          }
          else {
            $section.slideDown('fast', function () {
              $triangle.text(expandedIcon);
            });
          }
        });

        $title.prepend($triangle);
      });
    });
  });
</script>
</body>
</html>